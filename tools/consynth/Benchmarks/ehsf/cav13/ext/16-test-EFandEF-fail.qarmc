init(P2,K3,K4,PC):=P2=0,PC=1.
next(P2,K3,K4,PC,P2p,K3p,K4p,PCp):=
   PC=1,P2p=P2,K4p=K4,PCp=2;	% K3p = _rho
   PC=2,K3>0,P2p=P2,K3p=K3-1,K4p=K4,PCp=2; 
   PC=2,K3=<0,P2p=P2,K3p=K3,K4p=K4,PCp=3;
   PC=3,P2p=P2,K3p=K3,PCp=4;	% K4p = _rho
   PC=4,K4>0,P2p=P2,K3p=K3,K4p=K4-1,PCp=5; 
   PC=4,K4=<0,P2p=P2,K3p=K3,K4p=K4,PCp=6;
   PC=5,P2p=P2,K3p=K3,K4p=K4,PCp=3;
   PC=6,P2p=P2,K3p=K3,K4p=K4,PCp=7.
dst1(P2,K3,K4,PC):=P2=1.
% init => EF dst1
phi1(P2,K3,K4,PC):-init(P2,K3,K4,PC).
exists([P2p,K3p,K4p,PCp],
       (
 	 phi1(P2p,K3p,K4p,PCp),
 	 rank1(P2,K3,K4,PC,P2p,K3p,K4p,PCp)
       )):-
 	phi1(P2,K3,K4,PC),\+dst1(P2,K3,K4,PC).
wf(rank1/8).
skolem_template(s3, [P2,K3,K4,PC,P2p,K3p,K4p,PCp],
		true,
       		(PC>=1,PC=<6), 
  		(
  		  PC=1,P2p=P2,K3p=T3,K4p=K4,PCp=2; % K3p = _rho
  		  PC=2,K3>0,P2p=P2,K3p=K3-1,K4p=K4,PCp=2; 
  		  PC=2,K3=<0,P2p=P2,K3p=K3,K4p=K4,PCp=3;
  		  PC=3,P2p=P2,K3p=K3,K4p=T4,PCp=4; % K4p = _rho
  		  PC=4,K4>0,P2p=P2,K3p=K3,K4p=K4-1,PCp=5; 
  		  PC=4,K4=<0,P2p=P2,K3p=K3,K4p=K4,PCp=6;
  		  PC=5,P2p=P2,K3p=K3,K4p=K4,PCp=3;
  		  PC=6,P2p=P2,K3p=K3,K4p=K4,PCp=7
  		),
		((T3=0;T3=1),(T4=0;T4=1))
	       ).

query_naming(phi1(p2,k3,k4,pc)).
query_naming(rank1(p2,k3,k4,pc,'p2\'','k3\'','k4\'','pc\'')).
query_naming(rank1_p(p2,k3,k4,pc,'p2\'','k3\'','k4\'','pc\'')).
query_naming(s3(p2,k3,k4,pc,'p2\'','k3\'','k4\'','pc\'')).

query_finite_sorts(phi1/4,[4]).
query_finite_sorts(rank1/8,[4,8]).
query_finite_sorts(rank1_p/8,[4,8]).
query_finite_sorts(s3/8,[4,8]).

prog_rep([P2,K3,K4,PC,P2p,K3p,K4p,PCp],
	 (P2=0,PC=1),
	 (
	   PC=1,P2p=P2,K4p=K4,PCp=2; % K3p = _rho
	   PC=2,K3>0,P2p=P2,K3p=K3-1,K4p=K4,PCp=2; 
	   PC=2,K3=<0,P2p=P2,K3p=K3,K4p=K4,PCp=3;
	   PC=3,P2p=P2,K3p=K3,PCp=4; % K4p = _rho
	   PC=4,K4>0,P2p=P2,K3p=K3,K4p=K4-1,PCp=5; 
	   PC=4,K4=<0,P2p=P2,K3p=K3,K4p=K4,PCp=6;
	   PC=5,P2p=P2,K3p=K3,K4p=K4,PCp=3;
	   PC=6,P2p=P2,K3p=K3,K4p=K4,PCp=7
	 )
	).
% time ./ctlstar tests/ctlstar-Erics/Industrial/16-EFandEF-fail.qarmc -no-extra-insert-pred -use-next-skolem
% CEX after 874.5 sec
% With '-case-split': TO